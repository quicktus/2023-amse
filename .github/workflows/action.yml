name: Continuous Integration and Deployment
run-name: ${{ github.actor }} is using GitHub Actions to run a (simple) CI/CD workflow ðŸš€
on: [push]
jobs:
  Explore-GitHub-Actions:
    runs-on: ubuntu-latest
    steps:
      - run: echo "ðŸŽ‰ The job was automatically triggered by a ${{ github.event_name }} event."
      - run: echo "ðŸ§ This job is now running on a ${{ runner.os }} server hosted by GitHub!"
      - run: echo "ðŸ”Ž The name of your branch is ${{ github.ref }} and your repository is ${{ github.repository }}."
      - name: Check out repository code
        uses: actions/checkout@v3
      - run: echo "ðŸ’¡ The ${{ github.repository }} repository has been cloned to the runner."
      - run: echo "ðŸ–¥ï¸ The workflow is now ready to test your code on the runner."
      - name: Check if secrets exist and set them as environment variables
        run: |
          if [[ -z "${{ secrets.KAGGLE_KEY }}" ]]; then
            echo "KAGGLE_KEY secret does not exist."
            exit 1
          fi
          if [[ -z "${{ secrets.KAGGLE_USERNAME }}" ]]; then
            echo "KAGGLE_USERNAME secret does not exist."
            exit 1
          fi
          if [[ -z "${{ secrets.SPOTIFY_CLIENT_ID }}" ]]; then
            echo "SPOTIFY_CLIENT_ID secret does not exist."
            exit 1
          fi
          if [[ -z "${{ secrets.SPOTIFY_CLIENT_SECRET }}" ]]; then
            echo "SPOTIFY_CLIENT_SECRET secret does not exist."
            exit 1
          fi
          echo "all required secrets found."

          echo "KAGGLE_USERNAME=${{ secrets.KAGGLE_USERNAME }}" >> $GITHUB_ENV
          echo "KAGGLE_KEY=${{ secrets.KAGGLE_KEY }}" >> $GITHUB_ENV
          echo "SPOTIFY_CLIENT_ID=${{ secrets.SPOTIFY_CLIENT_ID }}" >> $GITHUB_ENV
          echo "SPOTIFY_CLIENT_SECRET=${{ secrets.SPOTIFY_CLIENT_SECRET }}" >> $GITHUB_ENV

          echo "secrets set as environment variables."
      - name: Set up Python
        uses: actions/setup-python@v2
        with:
          python-version: 3.11.3
      - name: Install dependencies
        run: pip install -r requirements.txt
      - name: Run tests.sh
        run: bash project/tests.sh
      - run: echo "Job completed."
